<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Тапалка</title>
  <style>
    body { font-family: Arial, sans-serif; background: linear-gradient(135deg,#000,#ff6600); color: #fff; text-align: center; padding: 20px; }
    button { padding: 10px 20px; margin: 10px; border: none; border-radius: 10px; background: #ffcc66; font-weight: bold; cursor: pointer; }
    button:active { transform: scale(0.95); }
    #leaderboard { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 10px; margin-top: 20px; max-width: 300px; margin-left:auto;margin-right:auto; }
    #leaderboard h3 { margin: 0 0 10px; color: #ffcc66; }
    #leaderboard ol { padding-left: 20px; text-align: left; }
    #player { margin: 15px 0; display: flex; flex-direction: column; align-items: center; gap: 8px; }
    #player input { padding: 6px 10px; border-radius: 6px; border: none; outline: none; }
    .highlight { color: #ffcc66; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Очки: <span id="score">0</span></h1>
  <h2>Множитель: <span id="mult">x1</span></h2>
  <button id="tapBtn">ТАП</button>

  <h3>Задания:</h3>
  <ul>
    <li id="task1">Набери 100 очков ❌</li>
    <li id="task2">Набери 300 очков ❌</li>
    <li id="task3">Набери 600 очков ❌</li>
  </ul>

  <div id="player">
    <input type="text" id="playerName" placeholder="Введи имя">
    <button id="saveBtn">Сохранить результат</button>
  </div>

  <div id="leaderboard">
    <h3>Лидерборд</h3>
    <ol id="leaders"></ol>
  </div>

<script>
let score = 0;
let multiplier = 1;
let completedTasks = [];
let gameEnded = false; // запрещает тап после сохранения

const scoreEl = document.getElementById("score");
const multEl = document.getElementById("mult");
const tapBtn = document.getElementById("tapBtn");
const leadersEl = document.getElementById("leaders");
const saveBtn = document.getElementById("saveBtn");
const playerNameInput = document.getElementById("playerName");

let leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || [];

function updateUI() {
  scoreEl.textContent = score;
  multEl.textContent = "x" + multiplier;
}

function checkTasks() {
  if (score >= 100 && !completedTasks.includes(1)) {
    document.getElementById("task1").textContent = "Набери 100 очков ✅ (x2 бонус!)";
    multiplier *= 2; completedTasks.push(1);
  }
  if (score >= 300 && !completedTasks.includes(2)) {
    document.getElementById("task2").textContent = "Набери 300 очков ✅ (x2 бонус!)";
    multiplier *= 2; completedTasks.push(2);
  }
  if (score >= 600 && !completedTasks.includes(3)) {
    document.getElementById("task3").textContent = "Набери 600 очков ✅ (x2 бонус!)";
    multiplier *= 2; completedTasks.push(3);
  }
}

function updateLeaderboard(highlightName = null) {
  leadersEl.innerHTML = "";
  leaderboard.forEach(entry => {
    const li = document.createElement("li");
    li.textContent = `${entry.name} — ${entry.score} очков`;
    if (highlightName && entry.name === highlightName) {
      li.classList.add("highlight");
    }
    leadersEl.appendChild(li);
  });
}

tapBtn.addEventListener("click", () => {
  if (gameEnded) return; // нельзя тапать после сохранения
  score += multiplier;
  checkTasks();
  updateUI();
});

saveBtn.addEventListener("click", () => {
  if (gameEnded) return; // нельзя сохранять второй раз
  const name = playerNameInput.value.trim() || "Безымянный";

  // ищем, есть ли игрок в таблице
  let existing = leaderboard.find(e => e.name === name);
  if (existing) {
    if (score > existing.score) {
      existing.score = score; // обновляем рекорд
    }
  } else {
    leaderboard.push({ name, score });
  }

  leaderboard.sort((a, b) => b.score - a.score);
  leaderboard = leaderboard.slice(0, 5);
  localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
  updateLeaderboard(name);

  gameEnded = true; // игра завершена
  saveBtn.disabled = true; // блокируем кнопку
});

updateUI();
updateLeaderboard();
</script>
</body>
</html>